Implementantion based on  https://arxiv.org/abs/2510.11370.