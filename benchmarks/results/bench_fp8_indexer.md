# FP8 Lightning Indexer Benchmark

## System Info
- **GPU:** NVIDIA B200
- **GPU Memory:** 178.4 GB
- **PyTorch:** 2.10.0+cu128
- **Triton:** 3.6.0
- **TileLang:** 0.1.8
- **CUDA:** 12.8
- **Python:** 3.12.12

## Parameters
- H=32, D=128, topk=2048
- warmup=5, rep=20

## Latency (ms)

| S | Profile | Triton BF16 (ms) | Triton FP8 (ms) | TileLang FP8 (ms) | BF16 vs TL | FP8 vs TL |
|---|---------|-----------------|----------------|-------------------|-----------|----------|
| 4096 | single_seq | 0.62 | 0.86 | 1.43 | 2.29x | 1.65x |
| 4096 | uniform_2048 | 0.58 | 0.81 | 1.09 | 1.89x | 1.35x |
| 4096 | uniform_4096 | 0.62 | 0.85 | 1.43 | 2.28x | 1.68x |
| 8192 | single_seq | 1.82 | 2.16 | 4.31 | 2.37x | 1.99x |
| 8192 | uniform_2048 | 1.52 | 1.96 | 2.47 | 1.62x | 1.26x |
| 8192 | uniform_4096 | 1.61 | 2.03 | 3.09 | 1.91x | 1.52x |
| 8192 | uniform_8192 | 1.82 | 2.16 | 4.31 | 2.37x | 2.00x |
| 16384 | single_seq | 6.14 | 6.27 | 14.37 | 2.34x | 2.29x |
| 16384 | uniform_2048 | 4.37 | 5.20 | 6.13 | 1.40x | 1.18x |
| 16384 | uniform_4096 | 4.59 | 5.35 | 7.32 | 1.59x | 1.37x |
| 16384 | uniform_8192 | 5.05 | 5.64 | 9.68 | 1.92x | 1.72x |
| 16384 | uniform_16384 | 6.14 | 6.27 | 14.36 | 2.34x | 2.29x |
| 32768 | single_seq | 23.45 | 22.97 | 52.75 | 2.25x | 2.30x |
| 32768 | uniform_2048 | 14.85 | 16.41 | 18.05 | 1.22x | 1.10x |
| 32768 | uniform_4096 | 15.40 | 16.85 | 20.46 | 1.33x | 1.21x |
| 32768 | uniform_8192 | 16.40 | 17.52 | 25.12 | 1.53x | 1.43x |
| 32768 | uniform_16384 | 18.84 | 19.08 | 34.36 | 1.82x | 1.80x |
| 65536 | single_seq | 93.78 | 90.18 | 205.29 | 2.19x | 2.28x |
| 65536 | uniform_2048 | 57.60 | 60.57 | 62.88 | 1.09x | 1.04x |
| 65536 | uniform_4096 | 59.31 | 62.03 | 68.12 | 1.15x | 1.10x |
| 65536 | uniform_8192 | 61.85 | 63.99 | 77.58 | 1.25x | 1.21x |
| 65536 | uniform_16384 | 67.08 | 67.95 | 95.95 | 1.43x | 1.41x |
| 131072 | single_seq | 366.30 | 345.76 | 830.56 | 2.27x | 2.40x |
| 131072 | uniform_2048 | 221.50 | 227.14 | 227.16 | 1.03x | 1.00x |
| 131072 | uniform_4096 | 226.88 | 231.89 | 238.93 | 1.05x | 1.03x |
| 131072 | uniform_8192 | 233.43 | 237.32 | 258.47 | 1.11x | 1.09x |
| 131072 | uniform_16384 | 243.68 | 245.92 | 295.41 | 1.21x | 1.20x |

## Peak GPU Memory (MB)

| S | Profile | Triton BF16 (MB) | Triton FP8 (MB) | TileLang (MB) |
|---|---------|-----------------|----------------|--------------|
| 4096 | single_seq | 469 | 518 | 550 |
| 4096 | uniform_2048 | 469 | 518 | 550 |
| 4096 | uniform_4096 | 469 | 518 | 550 |
| 8192 | single_seq | 823 | 920 | 984 |
| 8192 | uniform_2048 | 823 | 920 | 984 |
| 8192 | uniform_4096 | 823 | 920 | 984 |
| 8192 | uniform_8192 | 823 | 920 | 984 |
| 16384 | single_seq | 1913 | 2107 | 2235 |
| 16384 | uniform_2048 | 1913 | 2107 | 2235 |
| 16384 | uniform_4096 | 1913 | 2107 | 2235 |
| 16384 | uniform_8192 | 1913 | 2107 | 2235 |
| 16384 | uniform_16384 | 1913 | 2107 | 2235 |
| 32768 | single_seq | 5630 | 6019 | 6275 |
| 32768 | uniform_2048 | 5630 | 6019 | 6275 |
| 32768 | uniform_4096 | 5630 | 6019 | 6275 |
| 32768 | uniform_8192 | 5630 | 6019 | 6275 |
| 32768 | uniform_16384 | 5630 | 6019 | 6275 |
| 65536 | single_seq | 19209 | 19985 | 20497 |
| 65536 | uniform_2048 | 19209 | 19985 | 20497 |
| 65536 | uniform_4096 | 19209 | 19985 | 20497 |
| 65536 | uniform_8192 | 19209 | 19985 | 20497 |
| 65536 | uniform_16384 | 19209 | 19985 | 20497 |
| 131072 | single_seq | 70941 | 72494 | 73518 |
| 131072 | uniform_2048 | 70941 | 72494 | 73518 |
| 131072 | uniform_4096 | 70941 | 72494 | 73518 |
| 131072 | uniform_8192 | 70941 | 72494 | 73518 |
| 131072 | uniform_16384 | 70941 | 72494 | 73518 |

## Correctness vs TileLang FP8

| S | Profile | Triton FP8 Cosine | Triton FP8 Jaccard | Triton BF16 Cosine | Triton BF16 Jaccard |
|---|---------|------------------|-------------------|-------------------|-------------------|
| 4096 | single_seq | 1.0000 | 1.0000 | 0.9906 | 0.9752 |
| 4096 | uniform_2048 | 1.0000 | 1.0000 | 0.9906 | 1.0000 |
| 4096 | uniform_4096 | 1.0000 | 1.0000 | 0.9907 | 0.9745 |
| 8192 | single_seq | 1.0000 | 1.0000 | 0.9907 | 0.9338 |
| 8192 | uniform_2048 | 1.0000 | 1.0000 | 0.9906 | 1.0000 |
| 8192 | uniform_4096 | 1.0000 | 1.0000 | 0.9907 | 0.9740 |
| 8192 | uniform_8192 | 1.0000 | 1.0000 | 0.9904 | 0.9341 |
| 16384 | single_seq | 1.0000 | 1.0000 | 0.9906 | 0.8973 |
| 16384 | uniform_2048 | 1.0000 | 1.0000 | 0.9907 | 1.0000 |
| 16384 | uniform_4096 | 1.0000 | 1.0000 | 0.9906 | 0.9745 |
| 16384 | uniform_8192 | 1.0000 | 1.0000 | 0.9907 | 0.9367 |
| 16384 | uniform_16384 | 1.0000 | 1.0000 | 0.9907 | 0.8984 |
| 32768 | single_seq | 1.0000 | 1.0000 | 0.9907 | 0.8650 |
| 32768 | uniform_2048 | 1.0000 | 1.0000 | 0.9907 | 1.0000 |
| 32768 | uniform_4096 | 1.0000 | 1.0000 | 0.9906 | 0.9763 |
| 32768 | uniform_8192 | 1.0000 | 1.0000 | 0.9906 | 0.9355 |
| 32768 | uniform_16384 | 1.0000 | 1.0000 | 0.9906 | 0.8986 |
| 65536 | single_seq | 1.0000 | 1.0000 | 0.9907 | 0.8363 |
| 65536 | uniform_2048 | 1.0000 | 1.0000 | 0.9906 | 1.0000 |
| 65536 | uniform_4096 | 1.0000 | 1.0000 | 0.9906 | 0.9744 |
| 65536 | uniform_8192 | 1.0000 | 1.0000 | 0.9906 | 0.9355 |
| 65536 | uniform_16384 | 1.0000 | 1.0000 | 0.9906 | 0.8967 |
| 131072 | single_seq | OOM | 1.0000 | OOM | 0.8041 |
| 131072 | uniform_2048 | OOM | 1.0000 | OOM | 1.0000 |
| 131072 | uniform_4096 | OOM | 1.0000 | OOM | 0.9732 |
| 131072 | uniform_8192 | OOM | 1.0000 | OOM | 0.9364 |
| 131072 | uniform_16384 | OOM | 1.0000 | OOM | 0.8963 |
